<!DOCTYPE html>
<html lang="en">
<head>
  <title>CottageWare - Admin Products</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
  <link rel="stylesheet" href="/static/css/admin.css">
  <link rel="icon" href="/content/site-immagery/logo-transparent.svg" type="image/svg+xml">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  {% include 'includes/navbar.html' %}

  <!-- Main Content -->
  <main class="container">
    <section class="admin-panel">
      <div class="admin-header">
        <h2><i class="fas fa-shopping-cart"></i> Manage Products</h2>
        <div class="admin-actions">
          <a href="/admin" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
          <a href="/admin/products/new" class="btn btn-primary"><i class="fas fa-plus"></i> Add New Product</a>
        </div>
      </div>

      <div class="admin-products">
        <div class="products-search">
          <input type="text" id="product-search" placeholder="Search products...">
          <select id="product-filter">
            <option value="all">All Products</option>
            <option value="featured">Featured</option>
            <option value="regular">Regular</option>
          </select>
        </div>

        <div class="products-table">
          <table>
            <thead>
              <tr>
                <th>ID</th>
                <th>Image</th>
                <th>Name</th>
                <th>Price</th>
                <th>Sell.app ID</th>
                <th>Featured</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% if products %}
                {% for product in products %}
                <tr>
                  <td>{{ product.id }}</td>
                  <td>
                    <img src="{{ product.image_url or '/static/images/default-product.png' }}" alt="{{ product.name }}" class="product-thumbnail">
                  </td>
                  <td>{{ product.name }}</td>
                  <td>
                    {% if product.sale_price %}
                      <span class="original-price">${{ product.price }}</span>
                      <span class="sale-price">${{ product.sale_price }}</span>
                    {% else %}
                      ${{ product.price }}
                    {% endif %}
                  </td>
                  <td>{{ product.product_id }}</td>
                  <td>
                    <span class="status-badge {{ 'active' if product.is_featured else 'inactive' }}">
                      {{ "Featured" if product.is_featured else "Regular" }}
                    </span>
                  </td>
                  <td class="actions">
                    <a href="/admin/products/{{ product.id }}/edit" class="action-btn edit-btn" title="Edit">
                      <i class="fas fa-edit"></i>
                    </a>
                    <a href="/admin/products/{{ product.id }}/toggle-featured" class="action-btn toggle-btn" title="{{ 'Remove from Featured' if product.is_featured else 'Make Featured' }}">
                      <i class="fas fa-{{ 'star' if product.is_featured else 'star-half-alt' }}"></i>
                    </a>
                    <button class="action-btn delete-btn" data-id="{{ product.id }}" title="Delete">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </td>
                </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="7" class="no-products">No products found. <a href="/admin/products/new">Add a product</a></td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        
        <div class="pagination">
          {% if total_pages > 1 %}
            {% for i in range(1, total_pages + 1) %}
              <a href="/admin/products?page={{ i }}" class="page-link {{ 'active' if i == current_page else '' }}">{{ i }}</a>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    </section>
  </main>
  
  {% include 'includes/footer.html' %}
  
  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <h3>Confirm Deletion</h3>
      <p>Are you sure you want to delete this product? This action cannot be undone.</p>
      <div class="modal-actions">
        <button id="confirm-delete" class="btn btn-danger">Delete</button>
        <button id="cancel-delete" class="btn btn-secondary">Cancel</button>
      </div>
    </div>
  </div>
  
  <script>
    // Product search functionality
    document.getElementById('product-search').addEventListener('input', function() {
      const searchValue = this.value.toLowerCase();
      const rows = document.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        const productName = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
        if (productName.includes(searchValue)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    });
    
    // Product filter functionality
    document.getElementById('product-filter').addEventListener('change', function() {
      const filterValue = this.value;
      const rows = document.querySelectorAll('tbody tr');
      
      rows.forEach(row => {
        if (filterValue === 'all') {
          row.style.display = '';
        } else {
          const statusBadge = row.querySelector('.status-badge');
          if (statusBadge && 
              ((filterValue === 'featured' && statusBadge.classList.contains('active')) || 
               (filterValue === 'regular' && statusBadge.classList.contains('inactive')))) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        }
      });
    });
    
    // Delete modal functionality
    const modal = document.getElementById('delete-modal');
    const deleteButtons = document.querySelectorAll('.delete-btn');
    const confirmDelete = document.getElementById('confirm-delete');
    const cancelDelete = document.getElementById('cancel-delete');
    let productIdToDelete = null;
    
    deleteButtons.forEach(button => {
      button.addEventListener('click', function() {
        productIdToDelete = this.dataset.id;
        modal.style.display = 'flex';
      });
    });
    
    confirmDelete.addEventListener('click', function() {
      if (productIdToDelete) {
        window.location.href = `/admin/products/${productIdToDelete}/delete`;
      }
    });
    
    cancelDelete.addEventListener('click', function() {
      modal.style.display = 'none';
      productIdToDelete = null;
    });
    
    window.addEventListener('click', function(event) {
      if (event.target === modal) {
        modal.style.display = 'none';
        productIdToDelete = null;
      }
    });
  </script>
</body>
</html>
