<!DOCTYPE html>
<html lang="en">
<head>
  <title>CottageWare - {{ thread.title }}</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" href="/content/site-immagery/logo-transparent.svg" type="image/svg+xml">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Add syntax highlighting styles for code blocks in markdown -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>
<body>
  {% include 'includes/navbar.html' %}

  <!-- Main Content -->
  <main class="container">
    <!-- Thread Detail -->
    <section class="thread-detail">
      <div class="thread-breadcrumb">
        <a href="/forum">Forums</a> &gt; 
        <a href="/forum/{{ thread.forum.category_id }}">{{ thread.forum.category.name }}</a> &gt; 
        <a href="/forum/{{ thread.forum_id }}">{{ thread.forum.name }}</a> &gt; 
        <span>{{ thread.title }}</span>
      </div>
      
      <div class="thread-header">
        <h2 class="thread-title">
          {% if thread.is_sticky %}
            <span class="thread-icon sticky-icon" title="Sticky Thread">
              <i class="fas fa-thumbtack"></i>
            </span>
          {% endif %}
          
          {% if thread.is_locked %}
            <span class="thread-icon locked-icon" title="Locked Thread">
              <i class="fas fa-lock"></i>
            </span>
          {% endif %}
          
          {{ thread.title }}
        </h2>
        
        <div class="thread-meta">
          <span class="thread-views">
            <i class="fas fa-eye"></i> {{ thread.views }} views
          </span>
          <span class="thread-replies">
            <i class="fas fa-comment"></i> {{ reply_count }} replies
          </span>
        </div>
      </div>
      
      <!-- Posts List -->
      <div class="posts-list">
        <!-- Original Post -->
        <div id="post-{{ thread.id }}" class="post original-post">
          <div class="post-sidebar">
            <div class="post-author">
              <div class="author-avatar">
                {% if thread.author.avatar_url %}
                  <img src="{{ thread.author.avatar_url }}" alt="{{ thread.author.username }}" onerror="this.onerror=null; this.src='/static/images/default-avatar.png';">
                {% else %}
                  <div class="avatar-placeholder">
                    {{ thread.author.username[0].upper() }}
                  </div>
                {% endif %}
              </div>
              <div class="author-name">{{ thread.author.username }}</div>
              <div class="author-role">
                {% for role in thread.author.roles %}
                  <span class="role-badge">{{ role.name }}</span>
                {% endfor %}
              </div>
              <div class="author-joined">
                Joined: {{ thread.author.created_at.strftime('%b %Y') }}
              </div>
            </div>
          </div>
          
          <div class="post-content">
            <div class="post-header">
              <div class="post-date">
                {{ thread.created_at.strftime('%b %d, %Y %H:%M') }}
              </div>
              <div class="post-actions">
                <a href="#post-{{ thread.id }}" class="post-link" title="Link to this post">
                  <i class="fas fa-link"></i>
                </a>
              </div>
            </div>
            
            <div class="post-body">
              {{ thread.content|safe }}
            </div>
            
            {% if thread.author.profile and thread.author.profile.signature %}
              <div class="post-signature">
                {{ thread.author.profile.signature|safe }}
              </div>
            {% endif %}
          </div>
        </div>
        
        <!-- Reply Posts -->
        {% for post in posts %}
          <div id="post-{{ post.id }}" class="post">
            <div class="post-sidebar">
              <div class="post-author">
                <div class="author-avatar">
                  {% if post.author.avatar_url %}
                    <img src="{{ post.author.avatar_url }}" alt="{{ post.author.username }}" onerror="this.onerror=null; this.src='/static/images/default-avatar.png';">
                  {% else %}
                    <div class="avatar-placeholder">
                      {{ post.author.username[0].upper() }}
                    </div>
                  {% endif %}
                </div>
                <div class="author-name">{{ post.author.username }}</div>
                <div class="author-role">
                  {% for role in post.author.roles %}
                    <span class="role-badge">{{ role.name }}</span>
                  {% endfor %}
                </div>
                <div class="author-joined">
                  Joined: {{ post.author.created_at.strftime('%b %Y') }}
                </div>
              </div>
            </div>
            
            <div class="post-content">
              <div class="post-header">
                <div class="post-date">
                  {{ post.created_at.strftime('%b %d, %Y %H:%M') }}
                </div>
                <div class="post-actions">
                  <a href="#post-{{ post.id }}" class="post-link" title="Link to this post">
                    <i class="fas fa-link"></i>
                  </a>
                </div>
              </div>
              
              <div class="post-body">
                {{ post.content|safe }}
              </div>
              
              {% if post.author.profile and post.author.profile.signature %}
                <div class="post-signature">
                  {{ post.author.profile.signature|safe }}
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
      
      <!-- Reply Form -->
      {% if current_user and not thread.is_locked %}
        <div class="reply-form-container">
          <h3>Post a Reply</h3>
          <form class="reply-form" method="post" action="/thread/{{ thread.id }}/reply">
            <div class="form-group">
              <textarea name="content" rows="5" required placeholder="Write your reply here..."></textarea>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn">Post Reply</button>
            </div>
          </form>
        </div>
      {% elif thread.is_locked %}
        <div class="thread-locked-message">
          <i class="fas fa-lock"></i> This thread is locked. No new replies can be posted.
        </div>
      {% elif not current_user %}
        <div class="login-to-reply">
          <a href="/login?next=/thread/{{ thread.id }}" class="btn">
            <i class="fas fa-sign-in-alt"></i> Login to Reply
          </a>
        </div>
      {% endif %}
    </section>
  </main>

  {% include 'includes/footer.html' %}
</body>
</html>
